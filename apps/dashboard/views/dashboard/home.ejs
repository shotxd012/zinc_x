<section class="mb-6 py-3 text-center dark:bg-gray-900">
  <div class="grid gap-4 sm:grid-cols-2 sm:gap-6 lg:grid-cols-4">
    <!-- Card -->
    <div
      class="border-border bg-bg-panel hover:bg-bg-interactive flex flex-col rounded-xl border shadow-sm transition-all duration-200 hover:scale-[1.02] hover:transform hover:shadow-md">
      <div class="p-4 md:p-5">
        <div class="flex items-center gap-x-2">
          <i class="fa-solid fa-users text-primary dark:text-primary-light mr-1"></i>
          <p class="text-text-muted text-xs uppercase tracking-wide"><%= tr('HOME.MEMBERS') %></p>
        </div>

        <div class="mt-1 flex items-center gap-x-2">
          <h3 class="text-text text-xl font-medium sm:text-2xl"><%= guild.members %></h3>
        </div>
      </div>
    </div>

    <div
      class="border-border bg-bg-panel hover:bg-bg-interactive flex flex-col rounded-xl border shadow-sm transition-all duration-200 hover:scale-[1.02] hover:transform hover:shadow-md">
      <div class="p-4 md:p-5">
        <div class="flex items-center gap-x-2">
          <i class="fa-solid fa-tags text-primary dark:text-primary-light mr-1"></i>
          <p class="text-text-muted text-xs uppercase tracking-wide"><%= tr('HOME.ROLES') %></p>
        </div>

        <div class="mt-1 flex items-center gap-x-2">
          <h3 class="text-text text-xl font-medium sm:text-2xl"><%= guild.roles %></h3>
        </div>
      </div>
    </div>

    <div
      class="border-border bg-bg-panel hover:bg-bg-interactive flex flex-col rounded-xl border shadow-sm transition-all duration-200 hover:scale-[1.02] hover:transform hover:shadow-md">
      <div class="p-4 md:p-5">
        <div class="flex items-center gap-x-2">
          <i class="fa-solid fa-hashtag text-primary dark:text-primary-light mr-1"></i>
          <p class="text-text-muted text-xs uppercase tracking-wide"><%= tr('HOME.TXT_CHANNELS') %></p>
        </div>

        <div class="mt-1 flex items-center gap-x-2">
          <h3 class="text-text text-xl font-medium sm:text-2xl"><%= guild.channels.text %></h3>
        </div>
      </div>
    </div>

    <div
      class="border-border bg-bg-panel hover:bg-bg-interactive flex flex-col rounded-xl border shadow-sm transition-all duration-200 hover:scale-[1.02] hover:transform hover:shadow-md">
      <div class="p-4 md:p-5">
        <div class="flex items-center gap-x-2">
          <i class="fa-solid fa-microphone text-primary dark:text-primary-light mr-1"></i>
          <p class="text-text-muted text-xs uppercase tracking-wide"><%= tr('HOME.VC_CHANNELS') %></p>
        </div>

        <div class="mt-1 flex items-center gap-x-2">
          <h3 class="text-text text-xl font-medium sm:text-2xl"><%= guild.channels.voice %></h3>
        </div>
      </div>
    </div>
    <!-- End Card -->
  </div>
</section>

<section
  x-data="{
  view: localStorage.getItem('home-plugin-view') || 'grid',
  setView(v) {
    if (this.view === v) return; // Avoid unnecessary re-renders
    this.view = v;
    localStorage.setItem('home-plugin-view', v);
  }
}"
  x-cloak>
  <div class="mb-6">
    <!-- Header -->
    <div class="flex flex-wrap items-center justify-between gap-4">
      <h2 class="text-text text-2xl font-bold"><%= tr('HOME.SUB_PLUGINS') %></h2>
      <div class="flex gap-2">
        <button
          type="button"
          @click="setView('grid')"
          :class="view === 'grid' ? 'bg-primary text-white border border-primary-dark shadow' : 'bg-bg-panel text-text-muted border border-border'"
          class="btn flex items-center rounded px-3 py-1 text-sm font-medium transition-all duration-200">
          <i class="fa-solid fa-th mr-1"></i> Grid
        </button>
        <button
          type="button"
          @click="setView('list')"
          :class="view === 'list' ? 'bg-primary text-white border border-primary-dark shadow' : 'bg-bg-panel text-text-muted border border-border'"
          class="btn flex items-center rounded px-3 py-1 text-sm font-medium transition-all duration-200">
          <i class="fa-solid fa-list mr-1"></i> List
        </button>
      </div>
    </div>
  </div>

  <!-- Grid/List for plugin information -->
  <div
    x-show="view === 'grid'"
    x-transition:enter="transition-opacity ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition-opacity ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
    <% plugins.filter(p => !p.ownerOnly).forEach(plugin => { %>
    <div
      class="plugin-card bg-bg-panel border-border flex h-full flex-col rounded-xl border shadow-sm transition-all duration-300 hover:scale-[1.01] hover:transform hover:shadow-lg">
      <div class="border-border flex items-center justify-center border-b p-4">
        <div class="bg-bg-surface flex h-16 w-16 flex-shrink-0 items-center justify-center rounded-full">
          <i class="<%= plugin.icon %> text-primary-light h-8 w-8"></i>
        </div>
      </div>
      <div class="flex flex-1 flex-col justify-between p-4">
        <div>
          <h3 class="text-text mb-2 text-center text-lg font-bold">
            <%= plugin.name[0].toUpperCase() + plugin.name.slice(1) %>
          </h3>
          <p class="text-text-muted mb-3 text-sm"><%= plugin.description %></p>
          <div class="mb-4 flex flex-wrap justify-center gap-2">
            <span
              class="bg-primary-light inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium text-white">
              <i class="fa-solid fa-terminal mr-1 text-xs"></i>
              <%= pluginCmds[plugin.name]?.prefixCount || 0 %>
            </span>
            <span
              class="bg-primary-light inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium text-white">
              <i class="fa-solid fa-slash mr-1 text-xs"></i>
              <%= pluginCmds[plugin.name]?.slashCount || 0 %>
            </span>
          </div>
        </div>
        <div class="border-border mt-3 border-t pt-3">
          <% if(enabledPlugins.some(p => p.name === plugin.name)) { %>
          <a
            href="/dashboard/<%= guild.id %>/<%= plugin.name %>"
            class="border-primary bg-primary hover:bg-primary-dark focus:ring-primary inline-flex w-full items-center justify-center rounded-lg border px-3 py-1.5 text-sm font-medium text-white transition-colors duration-200 hover:text-white focus:outline-none focus:ring-4">
            <i class="fa-regular fa-circle-check me-1.5 h-4 w-4"></i>
            <%= tr('HOME.BTN_PLUGIN_ACTIVE') %>
          </a>
          <% } else { %>
          <button
            data-modal-target="modal-<%= plugin.name %>"
            data-modal-toggle="modal-<%= plugin.name %>"
            class="border-success text-success hover:bg-success-dark focus:ring-success inline-flex w-full items-center justify-center rounded-lg border px-3 py-1.5 text-sm font-medium hover:text-white focus:outline-none focus:ring-4">
            <i class="fa-solid fa-plus me-1.5 h-4 w-4"></i>
            <%= tr('HOME.BTN_PLUGIN_ENABLE') %>
          </button>
          <% } %>
        </div>
      </div>
    </div>
    <% }) %>
  </div>

  <div
    x-show="view === 'list'"
    x-transition:enter="transition-opacity ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition-opacity ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    x-cloak
    class="overflow-x-auto">
    <table class="divide-border bg-bg-panel min-w-full divide-y overflow-hidden rounded-xl shadow">
      <thead class="bg-bg-surface">
        <tr>
          <th class="text-text-muted px-4 py-2 text-left text-xs font-medium">Name</th>
          <th class="text-text-muted px-4 py-2 text-left text-xs font-medium">Description</th>
          <th class="text-text-muted px-4 py-2 text-left text-xs font-medium">Prefix</th>
          <th class="text-text-muted px-4 py-2 text-left text-xs font-medium">Slash</th>
          <th class="text-text-muted px-4 py-2 text-left text-xs font-medium">Version</th>
          <th class="text-text-muted px-4 py-2 text-left text-xs font-medium">Action</th>
        </tr>
      </thead>
      <tbody class="divide-border divide-y">
        <% plugins.filter(p => !p.ownerOnly).forEach(plugin => { %>
        <tr class="hover:bg-bg-interactive transition-colors duration-150">
          <td class="font-body text-text px-4 py-2">
            <div class="flex items-center">
              <i class="<%= plugin.icon %> text-primary mr-2 h-4 w-4"></i>
              <span class="text-text text-sm font-medium">
                <%= plugin.name[0].toUpperCase() + plugin.name.slice(1) %>
              </span>
            </div>
          </td>
          <td class="text-text-muted max-w-xs truncate px-4 py-2"><%= plugin.description %></td>
          <td class="px-4 py-2">
            <span
              class="bg-primary-light text-text inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium">
              <i class="fa-solid fa-terminal mr-1 text-xs"></i>
              <%= pluginCmds[plugin.name]?.prefixCount || 0 %>
            </span>
          </td>
          <td class="px-4 py-2">
            <span
              class="bg-primary-light inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium text-white">
              <i class="fa-solid fa-slash mr-1 text-xs"></i>
              <%= pluginCmds[plugin.name]?.slashCount || 0 %>
            </span>
          </td>
          <td class="text-text px-4 py-2 text-xs">v<%= plugin.version %></td>
          <td class="whitespace-nowrap px-4 py-2">
            <% if(enabledPlugins.some(p => p.name === plugin.name)) { %>
            <a
              href="/dashboard/<%= guild.id %>/<%= plugin.name %>"
              class="border-primary bg-primary hover:bg-primary-dark focus:ring-primary inline-flex items-center rounded-lg border px-3 py-1 text-xs font-medium text-white transition-colors duration-200 hover:text-white focus:outline-none focus:ring-4">
              <i class="fa-regular fa-circle-check me-1.5 h-3 w-3"></i>
              <%= tr('HOME.BTN_PLUGIN_ACTIVE') %>
            </a>
            <% } else { %>
            <button
              data-modal-target="modal-<%= plugin.name %>"
              data-modal-toggle="modal-<%= plugin.name %>"
              class="border-success text-success hover:bg-success-dark focus:ring-success inline-flex items-center rounded-lg border px-3 py-1 text-xs font-medium hover:text-white focus:outline-none focus:ring-4">
              <i class="fa-solid fa-plus me-1.5 h-3 w-3"></i>
              <%= tr('HOME.BTN_PLUGIN_ENABLE') %>
            </button>
            <% } %>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</section>

<% plugins.filter(p => !p.ownerOnly).forEach(plugin => { %> <% if(!enabledPlugins.some(p => p.name === plugin.name)) {
%>
<div
  id="modal-<%= plugin.name %>"
  tabindex="-1"
  class="fixed left-0 right-0 top-0 z-50 hidden h-[calc(100%-1rem)] max-h-full w-full items-center justify-center overflow-y-auto overflow-x-hidden md:inset-0">
  <div class="relative max-h-full w-full max-w-md p-4">
    <div class="border-border bg-bg-surface relative rounded-lg border shadow-lg">
      <button
        type="button"
        class="text-text-muted hover:bg-bg-interactive hover:text-text absolute end-2.5 top-3 ms-auto inline-flex h-8 w-8 items-center justify-center rounded-lg bg-transparent text-sm transition-colors duration-200"
        data-modal-hide="modal-<%= plugin.name %>">
        <i class="fa-solid fa-xmark h-4 w-4"></i>
        <span class="sr-only">Close modal</span>
      </button>
      <div class="p-6 text-center">
        <div class="mb-4 flex justify-center">
          <div class="bg-primary-light flex h-16 w-16 items-center justify-center rounded-full p-3">
            <i class="fa-regular fa-circle-question h-10 w-10 text-white"></i>
          </div>
        </div>
        <h3 class="text-text mb-5 text-lg font-semibold">
          Enable <%= plugin.name[0].toUpperCase() + plugin.name.slice(1) %> Plugin
        </h3>
        <p class="text-text-muted mb-5"><%= tr('HOME.PLUGIN_ENABLE_CONFIRM') %></p>
        <form method="post" class="flex flex-col justify-center gap-3 sm:flex-row sm:gap-4">
          <input type="hidden" name="plugin_enable" value="<%= plugin.name %>" />
          <button
            data-modal-hide="modal-<%= plugin.name %>"
            type="submit"
            class="bg-success hover:bg-success-dark focus:ring-success inline-flex items-center justify-center rounded-lg px-5 py-2.5 text-center text-sm font-medium text-white transition-colors duration-200 focus:outline-none focus:ring-4">
            <i class="fa-solid fa-check mr-1.5"></i>
            <%= tr('HOME.PLUGIN_CONFIRM_YES') %>
          </button>
          <button
            data-modal-hide="modal-<%= plugin.name %>"
            type="button"
            class="border-border bg-bg-surface text-text-muted hover:bg-bg-interactive hover:text-text focus:ring-border rounded-lg border px-5 py-2.5 text-sm font-medium transition-colors duration-200 focus:z-10 focus:outline-none focus:ring-4">
            <i class="fa-solid fa-xmark mr-1.5"></i>
            <%= tr('HOME.PLUGIN_CONFIRM_NO') %>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
<% } %> <% }) %>
