<aside
  id="sidebar"
  class="transition-width fixed left-0 top-0 z-20 flex hidden h-full w-64 flex-shrink-0 flex-col overflow-y-auto pt-16 font-normal duration-75 lg:flex"
  aria-label="Sidebar">
  <div class="border-border bg-bg-panel relative flex min-h-0 flex-1 flex-col border-r pt-0">
    <div class="mb-[50px] flex flex-1 flex-col overflow-y-auto pb-4 pt-5">
      <div class="divide-border bg-bg-panel space-y-1 divide-y px-3">
        <div class="space-y-2 pb-2">
          <% if (!locals.guild) { %>
          <a
            href="/dashboard"
            class="<%= slug === 'selector' ? 'bg-bg-interactive' : '' %> text-text hover:bg-bg-surface group flex items-center rounded-lg p-2 text-base">
            <i class="fa-solid fa-server text-text-muted group-hover:text-text"></i>
            <!-- Updated icon for Servers -->
            <span class="ml-3 text-sm md:text-base" sidebar-toggle-item><%= tr('SIDEBAR.SERVERS') %></span>
          </a>
          <% } else { %>
          <a href="/dashboard" class="text-text hover:bg-bg-surface group flex items-center rounded-lg p-2 text-base">
            <i class="fa-solid fa-arrow-left text-text-muted group-hover:text-text"></i>
            <span class="ml-3 text-sm md:text-base" sidebar-toggle-item><%= tr('SIDEBAR.BACK_TO_SERVERS') %></span>
          </a>

          <button
            id="dropdownGuildButton"
            data-dropdown-toggle="dropdownGuild"
            data-dropdown-placement="bottom"
            class="<%= slug === 'home' ? 'bg-bg-interactive' : '' %> text-text hover:bg-bg-surface border-border group flex w-full items-center rounded-lg border p-2 text-base transition duration-75"
            type="button">
            <img class="h-6 w-6 rounded-full" src="<%= guild.iconURL %>" alt="<%= guild.name %> icon" />
            <span class="ml-3 flex-1 whitespace-nowrap text-left text-sm md:text-base" sidebar-toggle-item
              ><%= guild.name %></span
            >
            <i class="fa-solid fa-angle-down"></i>
          </button>

          <!-- Dropdown menu -->
          <div
            id="dropdownGuild"
            class="bg-bg-panel border-border z-50 hidden max-w-full overflow-hidden rounded-lg border shadow-lg">
            <ul class="max-h-60 overflow-y-auto py-2" aria-labelledby="dropdownGuildButton">
              <!-- Guilds with admin rights first -->
              <% guilds.filter(g => g.admin && !g.settingsUrl.includes('discord.com')).forEach(function(g) { %>
              <li class="px-2">
                <a
                  href="<%= g.settingsUrl %>"
                  class="<%= guild && g.id === guild.id ? 'bg-bg-interactive' : 'hover:bg-bg-interactive' %> text-text flex items-center rounded-lg p-2 transition-colors duration-150">
                  <div class="ring-primary-light relative me-3 rounded-full ring-2">
                    <img
                      class="border-border h-8 w-8 rounded-full border shadow-sm"
                      src="<%= g.iconURL %>"
                      alt="<%= g.name %> icon" />
                  </div>
                  <div class="flex flex-1 items-center justify-between">
                    <span class="truncate font-medium"><%= g.name %></span>
                  </div>
                </a>
              </li>
              <% }); %>

              <!-- Guilds without admin rights -->
              <% guilds.filter(g => g.admin && g.settingsUrl.includes('discord.com')).forEach(function(g) { %>
              <li class="px-2">
                <a
                  href="<%= g.settingsUrl %>"
                  class="hover:bg-bg-interactive text-text flex items-center rounded-lg p-2 transition-colors duration-150">
                  <div class="ring-text-muted relative me-3 rounded-full ring-2">
                    <img
                      class="border-border h-8 w-8 rounded-full border shadow-sm"
                      src="<%= g.iconURL %>"
                      alt="<%= g.name %> icon" />
                  </div>
                  <div class="flex flex-1 items-center justify-between">
                    <span class="truncate font-medium"><%= g.name %></span>
                  </div>
                </a>
              </li>
              <% }); %>
            </ul>
          </div>
          <% } %>
        </div>
      </div>
      <div class="divide-border bg-bg-panel flex-1 space-y-1 divide-y px-3">
        <ul class="space-y-2 pb-2">
          <% if (locals.guild && locals.enabledPlugins) { %>

          <li>
            <button
              type="button"
              class="text-text hover:bg-bg-surface group flex w-full items-center rounded-lg p-2 text-base transition duration-75"
              aria-controls="dropdown-plugins"
              data-collapse-toggle="dropdown-plugins">
              <i class="fa-solid fa-plug text-text-muted group-hover:text-text text-xl"></i>
              <span class="ml-3 flex-1 whitespace-nowrap text-left text-sm md:text-base" sidebar-toggle-item
                ><%= tr('SIDEBAR.PLUGINS') %></span
              >
              <i class="fa-solid fa-angle-down"></i>
            </button>
            <ul id="dropdown-plugins" class="<%= slug.includes('plugins') ? '' : 'hidden' %> space-y-2 py-2">
              <% enabledPlugins.forEach(function(plugin) { if (plugin.ownerOnly) return; let urlName = plugin.name; let
              name = plugin.name.charAt(0).toUpperCase() + plugin.name.slice(1).toLowerCase(); %>
              <li id="<%= slug.includes(plugin.name) ? 'aside-active-item' : '' %>">
                <a
                  href="/dashboard/<%=guild.id%>/<%=urlName%>"
                  class="<%= slug.includes(plugin.name) ? 'bg-bg-interactive' : '' %> text-text hover:bg-bg-surface group flex items-center rounded-lg p-2 pl-11 text-sm transition duration-75 md:text-base">
                  <%=name%></a
                >
              </li>
              <% }); %>
            </ul>
          </li>

          <% } %>
        </ul>
      </div>
    </div>

    <%- include('./sidebar-bottom.ejs') %>
  </div>
</aside>

<div class="fixed inset-0 z-10 hidden bg-gray-900/50 dark:bg-gray-900/90" id="sidebarBackdrop"></div>
